<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
      Dispatcher - Documentation
  </title>

  <link href="https://www.braintreepayments.com/images/favicon-ccda0b14.png" rel="icon" type="image/png">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
  <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
  
  <link type="text/css" rel="stylesheet" href="styles/collapse.css">
  

  

  <!-- start Mixpanel -->
  <script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("1919205b2da72e4da3b9b6639b444d59");</script>
  <!-- end Mixpanel -->
</head>

<body>
  <svg style="display: none;">
    <defs>
      <symbol id="linkIcon" fill="#706d77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 0h24v24H0z" fill="none"/>
          <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
      </symbol>
    </defs>
  </svg>

  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger" class="navicon-button x">
    <div class="navicon"></div>
  </label>

  <label for="nav-trigger" class="overlay"></label>

  <div class="top-nav-wrapper">
    <ul>
      <li >
        <a href="index.html">
          
            <svg fill="#6D6D6D" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
              <path d="M0 0h24v24H0z" fill="none"/>
            </svg>
          
          
        </a>
      </li>

      

    </ul>
  </div>

  <nav>
    <h3 class="reference-title">
      reduce.ac Docs
    </h3>

    
      <h3>
        Resources
      </h3>
      
        <a href="http://thi.ng/umbrella">@thi.ng/umbrella</a>
      
    

    <h3>Modules</h3><ul><li id="Dispatcher-nav"><a href="module-Dispatcher.html">Dispatcher</a></li><li id="Streams-nav"><a href="module-Streams.html">Streams</a></li></ul><h3 id="global-nav">Global</h3><ul><li><a href="global.html#parse_href">parse_href</a></li></ul>
  </nav>

  <div id="main">
    
      <h1 class="page-title">
        Dispatcher
      </h1>
    

    

<section>
  <header>
    
      
  </header>

  <article>
    <div class="container-overview">
      
        

        
      
    </div>

    

    

    

     

    

    
        <h3 class="subsection-title">Members</h3>

        
            

<h4 class="name" id=".dispatcher">
  <span class="type-signature">(static, constant) </span>dispatcher<span class="type-signature"></span>
</h4>




  <div class="description">
    <h2><code>dispatcher</code></h2>
<p>Async <code>reduce</code> function, that passes an <em>object</em> as a
state container between Command invocations.</p>
<h3>TL;DR:</h3>
<p>Handles any state updates and/or other effects which
require <em>ordered</em> choreography and/or have a dependency
on some (a/sync) data produced by a user interaction.</p>
<h3>Synopsis:</h3>
<ul>
<li>very simple async finite state machine.</li>
<li>Commands are composed in-situ in userland (Ad hoc)</li>
<li>spools a collection of Commands as a Task</li>
<li>resolves any promises contained within a Command</li>
<li>passes an accumulator (STATE) to subsequent Commands in
a Task</li>
</ul>
<h3>Type checks on function signatures</h3>
<p>There are two valid forms for Task entries:</p>
<ol>
<li>a Unary function: alias/refer to sub Tasks</li>
<li>A Command object: dispatch to Command stream</li>
</ol>
<h2>Recognized Keys</h2>
<p>There are 5 recognized keys for a Command object:</p>
<blockquote>
<p>Required keys</p>
</blockquote>
<ol>
<li><code>sub$</code> key = primary identifier</li>
</ol>
<ul>
<li>used for registering handlers hooked onto the Command
stream.</li>
</ul>
<ol start="2">
<li><code>args</code> key = <strong>primary control structure</strong></li>
</ol>
<ul>
<li>non-function vals send the Command as-is</li>
<li><code>(0)=&gt;</code> nullary fns send the <em>args</em> as a Command to
the <code>sub$</code> stream of your choosing (see Ad-hoc Stream
Injection below)</li>
<li><code>(1)=&gt;</code> unary fns are passed the STATE and called</li>
<li>Promises (and those returned from <code>(1)=&gt;</code>) are
resolved</li>
<li>new vals are merged with STATE (dupe keys overwritten)</li>
</ul>
<blockquote>
<p>Promise-specific keys -&gt; binary (as in two parameter,
not boolean) functions:</p>
</blockquote>
<ol start="3">
<li>
<p><code>reso</code> key = handle resolved promises: <code>(2)=&gt;</code> MUST be
a binary fn <code>(STATE, resolved Promise) =&gt;</code></p>
</li>
<li>
<p><code>erro</code> key = handle rejected promises : <code>(2)=&gt;</code> MUST
be a binary fn <code>(STATE, Promise rejection) =&gt;</code></p>
</li>
</ol>
<blockquote>
<p>State-specific key:</p>
</blockquote>
<ol start="5">
<li><code>path</code> key = lens</li>
</ol>
<ul>
<li>this is used to cursor into the global state
<a href="http://thi.ng/atom">Atom</a> for global state evolution
(immutably of course)</li>
<li>you can do anything you want with it. It's allowed to
be any form of static data (no functions), but its
presence sets dispatcher to trigger a Command.</li>
</ul>
<h3>Subtasks:</h3>
<p>Subtasks are the way you compose tasks. Insert a Task and
the dispatcher will unpack it in place (super -&gt; sub
order preserved) A Subtask must be defined as a unary
function that accepts a state object and returns a Task,
e.g.:</p>
<h4>PSEUDO</h4>
<pre class="prettyprint source lang-js"><code>// { C: Command }
// ( S: STATE ) => [...]: Subtask
let someSubtask = state => [{C}, {C}, (S)=>[...], ...]
</code></pre>
<h4>Example</h4>
<pre class="prettyprint source lang-js"><code>// subtask example:
let subtask1 = state => [
 { args: state }, // no sub$ key = state continuation ðŸ‘€
 { sub$: &quot;state&quot;
 , path: [&quot;body&quot;]
 , args: { data: state.data } },
 { sub$: &quot;route&quot;
 , args: { route: { href: state.href } } }
]

// task
let task = [
 { args: { href: &quot;https://my.io/todos&quot; } }, // state init
 { sub$: &quot;fetch&quot;
 , args: ({href}) => fetch(href).then(r => r.json())
 , erro: (state, err) => ({ sub$: &quot;cancel&quot;, args: err })
 , reso: (state, res) => ({ data: res }) },
 state => subtask1(state), // subtask reference
 { sub$: &quot;FLIP&quot;
 , args: &quot;done&quot; }
]

</code></pre>
<h4>Use:</h4>
<pre class="prettyprint source lang-js"><code>import { run$ } from &quot;hurl&quot;

export const run = e => run$.next(e);

//... ðŸ“Œ TODO...
</code></pre>
<h3>Ad-hoc stream injection</h3>
<p>ADVANCED USE ONLY ðŸ‘½</p>
<p>HURL tries to hide the stream implentation from the user
as much as possible, but allows you to go further down
the rabbit hole if so desired. You may send Commands to a
separate stream of your own creation by using a unary
<code>(0)=&gt;</code> function signature as your <code>args</code> value If this
is the case, the dispatcher assumes the <code>sub$</code> key
references a stream and sends the return value of the
thunk to that stream</p>
<blockquote>
<p>Note: if you need to pass in state/data to your thunk,
put it in a subtask, where you can access/destructure the
data from the state passed into the subtask function</p>
</blockquote>
<pre class="prettyprint source lang-js"><code>import { stream, trace } from &quot;@thi.ng/rstream&quot;

// ad-hoc stream
let login = stream().subscribe(trace(&quot;login ->&quot;))

// subtask
let subtask_login = state => [
 { args: state },
 { sub$: login // &lt;- stream
 , args: { data: state.token } } // &lt;- use state
]

// task
let task = [
 { sub$: login
 , args: () => &quot;logging in...&quot; },
 { sub$: &quot;init&quot;
 , args: { href: &quot;https://my.io/auth&quot; } },
 { sub$: &quot;cookie&quot;
 , args: ({href}) => fetch(href).then(r => r.json())
 , erro: (state, err) => ({ sub$: &quot;cancel&quot;, args: err })
 , reso: (state, res) => ({ token: res }) },
 state => subtask_login(state),
 { sub$: login
 , args: () => &quot;log in success&quot; }
]
</code></pre>
  </div>




<dl class="details">

  

  

  

  

  

  

  

  

  

  

  

  

  
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source">
      <ul class="dummy">
        <li>
          <a href="dispatcher_index.js.html">dispatcher/index.js</a>, <a href="dispatcher_index.js.html#line201">line 201</a>
        </li>
      </ul>
    </dd>
  

  

  

  
</dl>






          
        
            

<h4 class="name" id=".task$">
  <span class="type-signature">(static, constant) </span>task$<span class="type-signature"></span>
</h4>




  <div class="description">
    <h2><code>task$</code></h2>
<p>Batch processing stream, listens for Tasks sent as an
array of Commands (including subtask functions)</p>
<p>stream (if array of event objects)</p>
  </div>




<dl class="details">

  

  

  

  

  

  

  

  

  

  

  

  

  
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source">
      <ul class="dummy">
        <li>
          <a href="dispatcher_index.js.html">dispatcher/index.js</a>, <a href="dispatcher_index.js.html#line308">line 308</a>
        </li>
      </ul>
    </dd>
  

  

  

  
</dl>






          
        
    

    

    

    
  </article>
</section>




  </div>

  <br class="clear">

  <footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a>
  </footer>

  <script src="scripts/linenumber.js"></script>
  <script src="scripts/pagelocation.js"></script>

  

</body>
</html>